# 要件定義書：ラクマネ（デジタル商品販売支援システム）

## 1. プロジェクト概要

### 1.1 成果目標
AIを活用してデジタル商品（プロンプト集・テンプレート等）を効率的に作成・販売し、月10〜30万円の継続収入を実現する自動化システム

### 1.2 成功指標

**定量的指標**
| 指標 | 目標値 |
|------|--------|
| 月間目標収益 | 10〜30万円 |
| 商品作成時間 | 1商品あたり10分以内（従来2時間） |
| 運用作業時間 | 週2時間以下 |
| 初月商品リリース | 3〜5商品 |

**定性的指標**
- AIがアイデア出しから説明文作成まで支援
- 売れる商品を見極める分析機能
- 作業の8割を自動化

### 1.3 ターゲットユーザー
- スキル・基盤ゼロからデジタル商品販売を始めたい個人
- 初期投資を抑えて不労所得を構築したい人

---

## 2. システム全体像

### 2.1 機能一覧

| ID | 機能名 | 概要 | 優先度 |
|----|--------|------|--------|
| F-001 | 商品アイデア生成 | カテゴリ・ターゲットからAIが商品案を生成 | 高 |
| F-002 | 商品説明文生成 | 売れる商品説明・タイトル・タグを自動生成 | 高 |
| F-003 | 価格提案 | 市場相場に基づく最適価格を提案 | 高 |
| F-004 | 売上データ取得 | Gumroad APIから売上を自動取得 | 高 |
| F-005 | 売上可視化 | 今月の売上・目標達成率をグラフ表示 | 中 |
| F-006 | 売れ筋分析 | 商品別販売数ランキング表示 | 中 |

### 2.2 ユーザーロール
- **一般ユーザー**: 全機能にアクセス可能（MVP版は単一ユーザー想定）

### 2.3 認証要件
- MVP版: 認証なし（ローカル利用前提）
- 将来版: Gumroad OAuth連携でログイン

---

## 3. ページ詳細仕様

### 3.1 P-001: 商品ジェネレーター

**基本情報**
| 項目 | 内容 |
|------|------|
| ページID | P-001 |
| ルート | `/generator` |
| 目的 | AIで売れる商品アイデア・説明文・価格を一括生成 |
| 権限 | 全ユーザー |

**画面要素**
| 要素 | 種類 | 説明 |
|------|------|------|
| カテゴリ選択 | ドロップダウン | プロンプト集/Notionテンプレ/Canvaテンプレ/電子書籍 |
| ターゲット入力 | テキストフィールド | 「誰向けの商品か」を自由入力 |
| 追加要望 | テキストエリア | オプション。特定の要望があれば入力 |
| 生成ボタン | ボタン | クリックでAI生成開始 |
| 生成結果エリア | カード | 商品名・説明文・価格・タグを表示 |
| コピーボタン | ボタン | 各項目をクリップボードにコピー |
| 再生成ボタン | ボタン | 別パターンを生成 |

**処理フロー**
```
1. ユーザーがカテゴリ・ターゲットを入力
2. 「生成」ボタンをクリック
3. バックエンドがClaude APIを呼び出し
4. AIが以下を生成:
   - 商品名（3案）
   - 商品説明文（200〜300文字）
   - 推奨価格（円）
   - 関連タグ（5個）
5. 結果をカード形式で表示
6. ユーザーが気に入った内容をコピーしてGumroadに登録
```

**AIプロンプト設計**
```
<役割>デジタル商品販売の専門家</役割>
<タスク>
カテゴリ: {category}
ターゲット: {target}
上記に基づき、Gumroadで売れる商品を提案してください。
</タスク>
<出力形式>
- 商品名（3案、キャッチーで検索されやすいもの）
- 商品説明（購買意欲を刺激する200-300文字）
- 推奨価格（市場相場を考慮）
- タグ（検索用キーワード5個）
</出力形式>
```

---

### 3.2 P-002: 売上ダッシュボード

**基本情報**
| 項目 | 内容 |
|------|------|
| ページID | P-002 |
| ルート | `/dashboard` |
| 目的 | Gumroad売上をリアルタイム表示、目標達成度を可視化 |
| 権限 | 全ユーザー |

**画面要素**
| 要素 | 種類 | 説明 |
|------|------|------|
| Gumroad連携ボタン | ボタン | 初回のみ。アクセストークン入力ダイアログ |
| 今月の売上 | 数値カード | 金額を大きく表示 |
| 目標達成率 | プログレスバー | 目標金額に対する達成率 |
| 販売数 | 数値カード | 今月の総販売数 |
| 売上推移グラフ | 折れ線グラフ | 日別売上の推移 |
| 商品別ランキング | リスト | 売上順に商品を表示 |
| 目標設定 | 入力フィールド | 月間目標金額を設定 |

**処理フロー**
```
1. 初回: ユーザーがGumroadアクセストークンを入力
2. トークンをローカルストレージに保存
3. Gumroad APIから売上データを取得
4. データを集計・整形
5. ダッシュボードに表示
6. 定期的に自動更新（5分間隔）
```

**Gumroad API連携**
```
エンドポイント: https://api.gumroad.com/v2/sales
認証: access_token（Bearer）
取得データ:
- sale_timestamp: 販売日時
- price: 販売価格
- product_name: 商品名
- email: 購入者メール（表示しない）
```

---

## 4. データ設計概要

### 4.1 エンティティ

**Settings（設定）**
| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| gumroad_token | string | Gumroadアクセストークン（暗号化） |
| monthly_goal | integer | 月間目標金額（円） |
| created_at | timestamp | 作成日時 |
| updated_at | timestamp | 更新日時 |

**GenerationHistory（生成履歴）**
| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| category | string | 商品カテゴリ |
| target | string | ターゲット層 |
| generated_content | JSON | AI生成結果 |
| created_at | timestamp | 作成日時 |

### 4.2 バリデーションルール

| フィールド | ルール |
|-----------|--------|
| gumroad_token | 必須、文字列、最大500文字 |
| monthly_goal | 必須、整数、1〜10,000,000 |
| category | 必須、定義済みカテゴリのみ |
| target | 必須、1〜200文字 |

---

## 5. セキュリティ要件

### 5.1 全体要件

| 項目 | 要件 |
|------|------|
| ヘルスチェック | `/api/health` エンドポイント実装 |
| グレースフルシャットダウン | SIGTERM対応、8秒タイムアウト |
| HTTPS | 本番環境で強制 |
| 入力値サニタイゼーション | 全ユーザー入力に適用 |

### 5.2 API キー管理

| 項目 | 対策 |
|------|------|
| Claude API Key | 環境変数で管理、フロントエンドに露出しない |
| Gumroad Token | ローカルストレージに保存（MVP版）、将来的には暗号化 |

### 5.3 CVSS 3.1 準拠チェックリスト

- [ ] SQLインジェクション対策（パラメータ化クエリ）
- [ ] XSS対策（出力エスケープ）
- [ ] CSRF対策（MVP版は対象外）
- [ ] 機密情報のログ出力禁止

---

## 6. 技術スタック

### 6.1 フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 18.x | UIフレームワーク |
| TypeScript | 5.x | 型安全性 |
| MUI | v6 | UIコンポーネント |
| Vite | 5.x | ビルドツール |
| React Router | v6 | ルーティング |
| Zustand | 最新 | 状態管理 |
| React Query | 最新 | サーバー状態管理 |
| Recharts | 最新 | グラフ描画 |

### 6.2 バックエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| Python | 3.11+ | ランタイム |
| FastAPI | 最新 | APIフレームワーク |
| Uvicorn | 最新 | ASGIサーバー |
| Anthropic SDK | 最新 | Claude API連携 |
| httpx | 最新 | HTTP クライアント |

### 6.3 データベース

| 技術 | 用途 |
|------|------|
| PostgreSQL (Neon) | メインDB（サーバーレス） |
| SQLAlchemy | ORM |

### 6.4 インフラ

| サービス | 用途 | 費用 |
|---------|------|------|
| Vercel | フロントエンドホスティング | 無料枠 |
| Google Cloud Run | バックエンドホスティング | 無料枠 |
| Neon | PostgreSQL | 無料枠 |

---

## 7. 外部サービス一覧

| サービス | 用途 | 認証方式 | 費用 |
|---------|------|---------|------|
| Claude API (Haiku) | テキスト生成 | API Key | 従量課金（月100〜500円） |
| Gumroad API | 売上データ取得 | OAuth 2.0 / Access Token | 無料 |
| Neon | データベース | Connection String | 無料枠 |

---

## 8. 非機能要件

### 8.1 パフォーマンス

| 項目 | 目標値 |
|------|--------|
| 商品生成レスポンス | 5秒以内 |
| ダッシュボード表示 | 2秒以内 |
| API応答時間 | 500ms以内（AI生成除く） |

### 8.2 可用性

| 項目 | 目標値 |
|------|--------|
| 稼働率 | 99%（月間ダウンタイム7時間以内） |

### 8.3 スケーラビリティ

- MVP版: 単一ユーザー利用を想定
- 将来版: 複数ユーザー対応時にDB設計を拡張

---

## 9. 開発フェーズ

### Phase 1: MVP（現在）
- [ ] 商品ジェネレーター（P-001）
- [ ] 売上ダッシュボード（P-002）

### Phase 2: 機能拡張（将来）
- [ ] 複数プラットフォーム対応（BOOTH、note）
- [ ] 商品画像自動生成（DALL-E連携）
- [ ] SNS自動投稿機能
- [ ] 売上予測AI

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| デジタル商品 | プロンプト集、テンプレート、電子書籍などダウンロード販売する商品 |
| Gumroad | 海外のデジタル商品販売プラットフォーム |
| プロンプト | AIに指示を与えるためのテキスト |
